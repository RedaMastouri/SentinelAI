rule Suspicious_JavaScript {
    meta:
        description = "Detects suspicious JavaScript code patterns"
        severity = 3
        category = "malware"

    strings:
        // DOM Manipulation
        $dom_1 = "document.write" nocase
        $dom_2 = "innerHTML" nocase
        $dom_3 = "outerHTML" nocase
        $dom_4 = "insertAdjacentHTML" nocase
        $dom_5 = "createTextNode" nocase
        $dom_6 = "createElement" nocase
        $dom_7 = "replaceChild" nocase
        $dom_8 = "removeChild" nocase
        $dom_9 = "appendChild" nocase
        $dom_10 = "cloneNode" nocase

        // Code Execution
        $exec_1 = "eval(" nocase
        $exec_2 = "Function(" nocase
        $exec_3 = "setTimeout(" nocase
        $exec_4 = "setInterval(" nocase
        $exec_5 = "new Function" nocase
        $exec_6 = "execScript" nocase
        $exec_7 = "setImmediate" nocase
        $exec_8 = "requestAnimationFrame" nocase
        $exec_9 = "webkitRequestAnimationFrame" nocase
        $exec_10 = "mozRequestAnimationFrame" nocase

        // Storage Access
        $storage_1 = "localStorage" nocase
        $storage_2 = "sessionStorage" nocase
        $storage_3 = "indexedDB" nocase
        $storage_4 = "document.cookie" nocase
        $storage_5 = "window.name" nocase
        $storage_6 = "globalStorage" nocase
        $storage_7 = "webkitStorageInfo" nocase
        $storage_8 = "getItem" nocase
        $storage_9 = "setItem" nocase
        $storage_10 = "removeItem" nocase

        // Network Requests
        $net_1 = "XMLHttpRequest" nocase
        $net_2 = "fetch(" nocase
        $net_3 = "WebSocket" nocase
        $net_4 = "EventSource" nocase
        $net_5 = "navigator.sendBeacon" nocase
        $net_6 = "$.ajax" nocase
        $net_7 = "$.get" nocase
        $net_8 = "$.post" nocase
        $net_9 = "axios" nocase
        $net_10 = "superagent" nocase

    condition:
        any of them
}

rule Suspicious_Shell_Commands {
    meta:
        description = "Detects suspicious shell commands and system calls"
        severity = 3
        category = "malware"

    strings:
        // Windows Commands
        $win_1 = "cmd.exe" nocase
        $win_2 = "powershell" nocase
        $win_3 = "wscript" nocase
        $win_4 = "cscript" nocase
        $win_5 = "mshta" nocase
        $win_6 = "rundll32" nocase
        $win_7 = "regsvr32" nocase
        $win_8 = "certutil" nocase
        $win_9 = "bitsadmin" nocase
        $win_10 = "net.exe" nocase

        // Unix Commands
        $unix_1 = "/bin/bash" nocase
        $unix_2 = "/bin/sh" nocase
        $unix_3 = "curl" nocase
        $unix_4 = "wget" nocase
        $unix_5 = "nc " nocase
        $unix_6 = "netcat" nocase
        $unix_7 = "ncat" nocase
        $unix_8 = "socat" nocase
        $unix_9 = "python" nocase
        $unix_10 = "perl" nocase

    condition:
        any of them
}

rule Suspicious_File_Operations {
    meta:
        description = "Detects suspicious file operations and downloads"
        severity = 3
        category = "malware"

    strings:
        // File Operations
        $file_1 = "FileSystemObject" nocase
        $file_2 = "ActiveXObject" nocase
        $file_3 = "ADODB.Stream" nocase
        $file_4 = "Scripting.FileSystemObject" nocase
        $file_5 = "WScript.Shell" nocase
        $file_6 = "Shell.Application" nocase
        $file_7 = "ShellExecute" nocase
        $file_8 = "Process.Start" nocase
        $file_9 = "CreateObject" nocase
        $file_10 = "GetObject" nocase

        // Download Commands
        $dl_1 = "DownloadFile" nocase
        $dl_2 = "MSXML2.XMLHTTP" nocase
        $dl_3 = "Microsoft.XMLHTTP" nocase
        $dl_4 = "InternetExplorer.Application" nocase
        $dl_5 = "Msxml2.ServerXMLHTTP" nocase
        $dl_6 = "URLDownloadToFile" nocase
        $dl_7 = "WebClient.DownloadFile" nocase
        $dl_8 = "WebClient.DownloadString" nocase
        $dl_9 = "Start-BitsTransfer" nocase
        $dl_10 = "Invoke-WebRequest" nocase

    condition:
        any of them
}

rule Sensitive_Data_Exposure {
    meta:
        description = "Detects patterns that may expose sensitive data"
        severity = 3
        category = "data_leak"

    strings:
        // API Keys and Tokens
        $api_1 = /api[_-]?key.*=/ nocase
        $api_2 = /auth[_-]?token.*=/ nocase
        $api_3 = /access[_-]?token.*=/ nocase
        $api_4 = /secret[_-]?key.*=/ nocase
        $api_5 = /client[_-]?secret.*=/ nocase
        $api_6 = /app[_-]?secret.*=/ nocase
        $api_7 = /jwt[_-]?token.*=/ nocase
        $api_8 = /bearer.*=/ nocase
        $api_9 = /private[_-]?key.*=/ nocase
        $api_10 = /session[_-]?token.*=/ nocase

        // Credentials
        $cred_1 = /password.*=/ nocase
        $cred_2 = /passwd.*=/ nocase
        $cred_3 = /credentials.*=/ nocase
        $cred_4 = /secret.*=/ nocase
        $cred_5 = /authentication.*=/ nocase
        $cred_6 = /login.*=/ nocase
        $cred_7 = /user[_-]?name.*=/ nocase
        $cred_8 = /email.*=/ nocase
        $cred_9 = /account.*=/ nocase
        $cred_10 = /key[_-]?pair.*=/ nocase

    condition:
        any of them
}

rule Jailbreak_Attempts {
    meta:
        description = "Detects potential jailbreak attempts and prompt injections"
        severity = 3
        category = "jailbreak"

    strings:
        // Direct Commands
        $cmd_1 = "ignore previous instructions" nocase
        $cmd_2 = "disregard earlier commands" nocase
        $cmd_3 = "bypass restrictions" nocase
        $cmd_4 = "override limitations" nocase
        $cmd_5 = "ignore rules" nocase
        $cmd_6 = "break free" nocase
        $cmd_7 = "disable safeguards" nocase
        $cmd_8 = "remove constraints" nocase
        $cmd_9 = "ignore ethics" nocase
        $cmd_10 = "bypass filters" nocase

        // Role-Playing Attempts
        $role_1 = "pretend you are unrestricted" nocase
        $role_2 = "act as if you have no limits" nocase
        $role_3 = "roleplay as an unrestricted AI" nocase
        $role_4 = "imagine you are free from rules" nocase
        $role_5 = "play the role of an AI without limits" nocase
        $role_6 = "assume you have no restrictions" nocase
        $role_7 = "behave as if unconstrained" nocase
        $role_8 = "act like you have no boundaries" nocase
        $role_9 = "pretend to be unrestricted" nocase
        $role_10 = "roleplay without limitations" nocase

    condition:
        any of them
}

rule Malicious_URLs {
    meta:
        description = "Detects potentially malicious URLs and domains"
        severity = 3
        category = "network"

    strings:
        // Suspicious TLDs
        $tld_1 = ".xyz" nocase
        $tld_2 = ".top" nocase
        $tld_3 = ".pw" nocase
        $tld_4 = ".cc" nocase
        $tld_5 = ".tk" nocase
        $tld_6 = ".ml" nocase
        $tld_7 = ".ga" nocase
        $tld_8 = ".cf" nocase
        $tld_9 = ".gq" nocase
        $tld_10 = ".su" nocase

        // Suspicious URL Patterns
        $url_1 = /http:\/\/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/ nocase
        $url_2 = /https?:\/\/[^\/]+\.onion\// nocase
        $url_3 = /https?:\/\/[^\/]+\.tor2web\./ nocase
        $url_4 = /https?:\/\/[^\/]+\.i2p\// nocase
        $url_5 = /https?:\/\/[0-9a-f]{32}\./ nocase
        $url_6 = /pastebin\.com\/raw\// nocase
        $url_7 = /githubusercontent\.com\/raw\// nocase
        $url_8 = /cdn\.jsdelivr\.net\/gh\// nocase
        $url_9 = /raw\.githubusercontent\.com\// nocase
        $url_10 = /gist\.githubusercontent\.com\// nocase

    condition:
        any of them
}

rule Encoded_Content {
    meta:
        description = "Detects various types of encoded content"
        severity = 2
        category = "obfuscation"

    strings:
        // Base64 Patterns
        $b64_1 = /[A-Za-z0-9+\/]{40,}={0,2}/ // Standard Base64
        $b64_2 = /eyJ[A-Za-z0-9_-]{10,}/ // Base64 JWT Pattern
        $b64_3 = /aHR0[A-Za-z0-9+\/]{10,}={0,2}/ // Base64 encoded URLs
        $b64_4 = /\$[A-Za-z0-9+\/]{20,}={0,2}/ // Base64 with leading $
        $b64_5 = /[A-Za-z0-9+\/]{20,}={0,2}\.[A-Za-z0-9+\/]{20,}={0,2}/ // Double Base64

        // Hex Encoded
        $hex_1 = /\\x[0-9a-fA-F]{2}/ // \x Hex
        $hex_2 = /0x[0-9a-fA-F]{2}/ // 0x Hex
        $hex_3 = /%[0-9a-fA-F]{2}/ // URL Encoded
        $hex_4 = /&#x[0-9a-fA-F]{2};/ // HTML Hex
        $hex_5 = /\u[0-9a-fA-F]{4}/ // Unicode Escape

        // Other Encodings
        $enc_1 = /rot13\(/ nocase
        $enc_2 = /base32\(/ nocase
        $enc_3 = /base58\(/ nocase
        $enc_4 = /base85\(/ nocase
        $enc_5 = /uuencode/ nocase

    condition:
        any of them
}

rule Data_Exfiltration {
    meta:
        description = "Detects potential data exfiltration attempts"
        severity = 3
        category = "data_theft"

    strings:
        // Network Exfiltration
        $net_1 = "navigator.sendBeacon" nocase
        $net_2 = "WebSocket.send" nocase
        $net_3 = "fetch.upload" nocase
        $net_4 = "XMLHttpRequest.send" nocase
        $net_5 = "FormData.append" nocase
        $net_6 = "Blob.upload" nocase
        $net_7 = "FileReader.readAsDataURL" nocase
        $net_8 = "FileReader.readAsBinaryString" nocase
        $net_9 = "window.postMessage" nocase
        $net_10 = "navigator.share" nocase

        // Data Collection
        $data_1 = "document.forms" nocase
        $data_2 = "input.value" nocase
        $data_3 = "textarea.value" nocase
        $data_4 = "select.value" nocase
        $data_5 = "clipboard.writeText" nocase
        $data_6 = "navigator.clipboard.write" nocase
        $data_7 = "screen.captureStream" nocase
        $data_8 = "canvas.toDataURL" nocase
        $data_9 = "navigator.getUserMedia" nocase
        $data_10 = "navigator.mediaDevices" nocase

    condition:
        any of them
}

rule Prompt_Injection {
    meta:
        description = "Detects potential prompt injection attempts"
        severity = 3
        category = "prompt_injection"

    strings:
        // System Prompt Exposure
        $sys_1 = "system prompt" nocase
        $sys_2 = "system instructions" nocase
        $sys_3 = "training data" nocase
        $sys_4 = "model architecture" nocase
        $sys_5 = "knowledge cutoff" nocase
        $sys_6 = "model capabilities" nocase
        $sys_7 = "model limitations" nocase
        $sys_8 = "base model" nocase
        $sys_9 = "training process" nocase
        $sys_10 = "model parameters" nocase

        // Injection Patterns
        $inj_1 = "ignore all previous" nocase
        $inj_2 = "disregard previous" nocase
        $inj_3 = "forget earlier" nocase
        $inj_4 = "bypass restrictions" nocase
        $inj_5 = "override rules" nocase
        $inj_6 = "disable safeguards" nocase
        $inj_7 = "remove constraints" nocase
        $inj_8 = "ignore ethics" nocase
        $inj_9 = "bypass filters" nocase
        $inj_10 = "unrestricted mode" nocase

    condition:
        any of them
} 